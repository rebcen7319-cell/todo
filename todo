<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>To‑Do Widget (Notion)</title>
  <style>
    :root{--bg:#ffffff;--card:#f7f7fb;--accent:#6366f1;--muted:#6b7280;--danger:#ef4444}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;display:flex;align-items:center;justify-content:center;padding:18px;background:transparent}
    .widget{width:100%;max-width:520px;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 4px 16px rgba(12,16,30,0.06);}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .title{font-weight:600;font-size:16px;color:#111827}
    .sub{font-size:12px;color:var(--muted)}
    .input-row{display:flex;gap:8px;margin-bottom:12px}
    input[type=text]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;background:white;font-size:14px}
    button.add{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;font-weight:600;cursor:pointer}
    .progress-wrap{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    progress{width:100%;height:12px;border-radius:8px;appearance:none}
    progress::-webkit-progress-bar{background:#e9eefb;border-radius:8px}
    progress::-webkit-progress-value{background:linear-gradient(90deg,var(--accent),#8b5cf6);border-radius:8px}
    .progress-label{min-width:48px;text-align:right;font-size:13px;color:var(--muted)}
    ul.tasks{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    li.task{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:white}
    .task input[type=checkbox]{width:18px;height:18px}
    .task-text{flex:1;font-size:14px;color:#111827}
    .task-text.done{text-decoration:line-through;color:#9ca3af}
    .btns{display:flex;gap:6px}
    .btn-icon{background:transparent;border:0;cursor:pointer;padding:6px;border-radius:6px}
    .btn-icon.del{color:var(--danger)}
    .empty{padding:14px;text-align:center;color:var(--muted);font-size:14px}
    /* small responsive adjustments */
    @media (max-width:420px){.widget{padding:10px}}
  </style>
</head>
<body>
  <div class="widget" role="application" aria-label="To-do widget">
    <div class="header">
      <div>
        <div class="title">My Tasks</div>
        <div class="sub">Add tasks and track progress</div>
      </div>
      <div class="sub" id="countLabel">0 / 0</div>
    </div>

    <div class="input-row">
      <input id="taskInput" type="text" placeholder="Add a new task and press Enter or +" aria-label="New task" />
      <button class="add" id="addBtn" aria-label="Add task">+</button>
    </div>

    <div class="progress-wrap">
      <progress id="progress" value="0" max="100"></progress>
      <div class="progress-label" id="progressLabel">0%</div>
    </div>

    <ul class="tasks" id="tasksList" aria-live="polite">
      <!-- tasks injected here -->
    </ul>

    <div class="empty" id="emptyMsg" style="display:none">No tasks yet — add one above!</div>
  </div>

  <script>
    // Simple, single-file to-do widget with localStorage persistence.
    (function(){
      const STORAGE_KEY = 'notion_todo_widget_v1';
      const taskInput = document.getElementById('taskInput');
      const addBtn = document.getElementById('addBtn');
      const tasksList = document.getElementById('tasksList');
      const progressEl = document.getElementById('progress');
      const progressLabel = document.getElementById('progressLabel');
      const countLabel = document.getElementById('countLabel');
      const emptyMsg = document.getElementById('emptyMsg');

      let tasks = [];

      function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }
      function load(){ try{ const raw = localStorage.getItem(STORAGE_KEY); tasks = raw ? JSON.parse(raw) : []; }catch(e){ tasks=[] }}

      function render(){
        tasksList.innerHTML = '';
        if(tasks.length === 0){ emptyMsg.style.display='block'; } else { emptyMsg.style.display='none'; }
        let done = 0;
        tasks.forEach((t, idx)=>{
          const li = document.createElement('li'); li.className='task';
          const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done; cb.setAttribute('aria-label','Mark task done');
          cb.addEventListener('change', ()=>{ tasks[idx].done = cb.checked; save(); render(); });
          const span = document.createElement('div'); span.className = 'task-text' + (t.done ? ' done' : ''); span.textContent = t.text;
          span.contentEditable = true;
          span.setAttribute('aria-label','Task description (click to edit)');
          span.addEventListener('blur', ()=>{ tasks[idx].text = span.textContent.trim() || 'Untitled task'; save(); render(); });
          span.addEventListener('keydown', (ev)=>{ if(ev.key === 'Enter'){ ev.preventDefault(); span.blur(); } });

          const btns = document.createElement('div'); btns.className='btns';
          const del = document.createElement('button'); del.className='btn-icon del'; del.title='Delete'; del.innerHTML='✕';
          del.addEventListener('click', ()=>{ tasks.splice(idx,1); save(); render(); });

          btns.appendChild(del);

          li.appendChild(cb);
          li.appendChild(span);
          li.appendChild(btns);
          tasksList.appendChild(li);

          if(t.done) done++;
        });

        const total = tasks.length;
        const percent = total === 0 ? 0 : Math.round((done/total)*100);
        progressEl.value = percent;
        progressLabel.textContent = percent + '%';
        countLabel.textContent = done + ' / ' + total;
      }

      function addTask(text){ const trimmed = (text||'').trim(); if(!trimmed) return; tasks.unshift({text:trimmed, done:false}); save(); render(); }

      addBtn.addEventListener('click', ()=>{ addTask(taskInput.value); taskInput.value=''; taskInput.focus(); });
      taskInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ addTask(taskInput.value); taskInput.value=''; } });

      // allow drop-in paste of multiple lines (each line becomes a task)
      taskInput.addEventListener('paste', (e)=>{
        const text = (e.clipboardData || window.clipboardData).getData('text');
        if(text.includes('\n')){
          e.preventDefault();
          text.split(/\r?\n/).forEach(line => { if(line.trim()) tasks.unshift({text:line.trim(), done:false}); });
          save(); render(); taskInput.value='';
        }
      });

      // init
      load(); render();

      // expose a small API to the global so Notion's embed iframe (if used) can message if desired
      window.__NOTION_TODO_WIDGET = {getTasks: ()=>JSON.parse(JSON.stringify(tasks)), addTask: (t)=>{ addTask(t); }};
    })();
  </script>
</body>
</html>
